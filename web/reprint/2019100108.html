<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="åˆ©ç”¨ Workbox å®ç°åšå®¢çš„ PWA" />
<meta property="og:description" content="é€šè¿‡ Workbox (via workbox-build &amp; gulp) ç”Ÿæˆ Service Worker ä»¥å°†ä½ çš„åšå®¢å˜æˆä¸€ä¸ª PWA ç«™ç‚¹" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://pub.oribos.cn/web/reprint/2019100108.html" /><meta property="article:section" content="tech" />
<meta property="article:published_time" content="2019-10-01T21:32:34+08:00" />
<meta property="article:modified_time" content="2019-10-01T21:32:34+08:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="åˆ©ç”¨ Workbox å®ç°åšå®¢çš„ PWA"/>
<meta name="twitter:description" content="é€šè¿‡ Workbox (via workbox-build &amp; gulp) ç”Ÿæˆ Service Worker ä»¥å°†ä½ çš„åšå®¢å˜æˆä¸€ä¸ª PWA ç«™ç‚¹"/>

  
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#262d33">
  <title>
    
    è®°äº‹æœ¬ - åˆ©ç”¨ Workbox å®ç°åšå®¢çš„ PWA
    
  </title>
  
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">

  
  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/css/bootstrap.min.css">
 
  
  <script src="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/js/bootstrap.bundle.min.js"></script>  
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&display=swap"
    rel="stylesheet">
  
  
  
  <link rel="stylesheet" href="/minima.1661830171.css">

  
  
  <link rel="stylesheet" href="/css/app.css">
  <script defer type="text/javascript" src="/minima.1661830171.js"></script>
  <script src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js"></script>

  <script src="/js/app.js"></script>
  
</head>
<script>
  
  let theme_2b_used = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';

  try {
    if (!('theme' in localStorage)) {
      const default_theme = 'system';
      
      
      if (default_theme === 'dark' || default_theme === 'light') {
        theme_2b_used = default_theme;
      }

      
      localStorage.theme = theme_2b_used;
    }
    
    document.querySelector('html').classList.add(localStorage.theme);
  } catch (e) {
    console.error(e);
  }
</script>


<body class=" sm:mx-5 sm:my-0">
  <header class="flex justify-between items-center mb-6 sm:my-3">
  
  <nav class="flex items-center whitespace-nowrap overflow-x-auto overflow-y-hidden">
    
    <a class="ml-3 mr-3" href="/">é¦–é¡µ</a>
    
    <a class="ml-3 mr-3" href="/tech">æŠ€æœ¯</a>
    
    <a class="ml-3 mr-3" href="/essay">éšç¬”</a>
    
    <a class="ml-3 mr-3" href="/about">å…³äº</a>
    
  </nav>
  <div class="flex items-center">
    <div id="theme-switcher" class="text-4xl cursor-pointer">ğŸŒ»</div>
  </div>
</header>
  
  

<h2 class="mt-2 mb-2 text-info">åˆ©ç”¨ Workbox å®ç°åšå®¢çš„ PWA</h2>
<hr class="hr-colorful">
<div class="mb-3 text-xs flex justify-between sm:flex-col">
	<div>
	 ä½œè€… <b>reuixiy</b> |
	
		Posted at Oct 01, 2019
	
		
	</div>
	
	<div class="sm:mt-4">
		
		<a class="not-first:ml-3" href="/tags/hugo">#hugo</a>
		
		<a class="not-first:ml-3" href="/tags/pwa">#pwa</a>
		
	</div>
	
</div>
<main>
	<p>é€šè¿‡ Workbox (via workbox-build &amp; gulp) ç”Ÿæˆ Service Worker ä»¥å°†ä½ çš„åšå®¢å˜æˆä¸€ä¸ª PWA ç«™ç‚¹</p>
	<article class="md">
		<blockquote>
<p>å¼•ç”¨è‡ª<a href="https://io-oi.me/">reuixiy</a></p>
</blockquote>
<p><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup><img src="https://base.oribos.city/images/2020/07/pwa.png" alt="pwa.png" title="PWA"></p>
<p>å¦‚æœä½ ä½¿ç”¨ Google Chrome æµè§ˆå™¨è®¿é—®æˆ‘çš„åšå®¢ğŸ’»ï¼Œä½ å¯èƒ½ä¼šå‘ç°åœ°å€æ å³ä¾§æœ‰ä¸€ä¸ªå°å°çš„ <code>+</code> å·ï¼Œå¹¶ä¼šæé†’ä½ å®‰è£…ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ˜¯ç”¨æ‰‹æœºè®¿é—®çš„è¯ğŸ“±ï¼ŒChrome å°±ä¼šåœ¨é¡µé¢çš„åº•éƒ¨æé†’ä½ ã€‚ä½†ä½ å¯åƒä¸‡åƒä¸‡ä¸è¦æŠŠå®ƒå½“ä½œä»€ä¹ˆæ¶æ„éªšæ‰°å“¦ğŸ˜…ï¼Œå®ƒåªæ˜¯å–„æ„åœ°æé†’ä½ ï¼šè¿™ä¸ªç½‘ç«™æ˜¯ä¸€ä¸ª <a href="https://developers.google.com/web/progressive-web-apps/">PWA</a> ç«™ç‚¹ï¼Œå¼ºçƒˆæ¨èæ‚¨æ·»åŠ åˆ°æ¡Œé¢ä»¥è·å–åŸç”Ÿåº”ç”¨èˆ¬çš„ä¼˜è´¨ä½“éªŒï¼ğŸ˜</p>
<p><strong>æ³¨æ„</strong>ï¼šè¯·æŸ¥çœ‹<a href="/tech/a-simple-service-worker/">ä¸€ä¸ªç®€å•çš„ Service Worker</a>ã€‚</p>
<h2 id="å‰è¨€">å‰è¨€</h2>
<blockquote>
<p>æ¸è¿›å¼ç½‘ç»œåº”ç”¨ç¨‹åºï¼ˆè‹±è¯­ï¼š<strong>P</strong>rogressive <strong>W</strong>eb <strong>A</strong>ppsï¼Œç®€ç§°ï¼š<strong>PWA</strong>ï¼‰æ˜¯ä¸€ç§è¿ç”¨ç°ä»£çš„ Web API ä»¥åŠä¼ ç»Ÿçš„æ¸è¿›å¼å¢å¼ºç­–ç•¥åˆ›å»ºçš„è·¨å¹³å° Web åº”ç”¨ç¨‹åºã€‚è¿™ç§åº”ç”¨ç¨‹åºå°†ç›®å‰æœ€ä¸ºç°ä»£åŒ–çš„æµè§ˆå™¨æä¾›çš„åŠŸèƒ½ä¸ç§»åŠ¨è®¾å¤‡çš„ä½“éªŒä¼˜åŠ¿ç›¸ç»“åˆï¼Œä½¿å…¶å…·æœ‰ä¸åŸç”Ÿåº”ç”¨ç›¸åŒçš„ç”¨æˆ·ä½“éªŒä¼˜åŠ¿ã€‚<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
</blockquote>
<p>ä»¥ä¸Šæ˜¯å¼€å‘è€…è§’åº¦ï¼Œå°±ç”¨æˆ·è§’åº¦æ¥è¯´ğŸ¼ï¼Œå½“ä½ çš„åšå®¢å®ç° PWA åï¼Œä½ çš„è¯»è€…å¯ä»¥ï¼š</p>
<ol>
<li>æ·»åŠ ä½ çš„åšå®¢åˆ°ç”µè„‘â•±æ‰‹æœºçš„æ¡Œé¢ï¼Œä»¥åŸç”Ÿåº”ç”¨èˆ¬çš„æ–¹å¼æµè§ˆä½ çš„åšå®¢</li>
<li>æ›´å¿«é€Ÿåœ°æµè§ˆä½ çš„åšå®¢</li>
<li>ç¦»çº¿æµè§ˆä½ çš„åšå®¢</li>
</ol>
<p>ç¬¬ä¸€ç‚¹ï¼šå¯¹äºè¯»è€…ï¼Œåšå®¢å¯ä¸€è§¦å³è¾¾ï¼Œä¸”æ— æµè§ˆå™¨çš„åœ°å€æ ã€èœå•æ ç­‰ã€Œæ— å…³ã€å¹²æ‰°ğŸ‘´ï¼›å¯¹äºåšå®¢ï¼Œéå¸¸æœ‰åˆ©äºåšå®¢çš„ç”¨æˆ·ç•™å­˜ç‡ï¼Œä¹Ÿåˆ©äºåšå®¢çš„å“ç‰Œå½¢è±¡ğŸ˜ºã€‚ç¬¬äºŒç‚¹ï¼šå¯ä»¥åˆ©ç”¨ Service Worker çš„ç¼“å­˜ç‰¹ç‚¹ï¼Œæå¤§åœ°åŠ é€Ÿä½ çš„åšå®¢ï¼Œå¦‚æœå†åŠ ä¸Š <a href="/tech/speed-up-hexo/">InstantClick</a> çš„é¢„åŠ è½½ç‰¹ç‚¹ï¼Œç®€ç›´é£é€ŸğŸš€ã€‚ç¬¬ä¸‰ç‚¹ï¼šå¯¹åšå®¢æ¥è¯´ï¼Œä¸ªäººæ„Ÿè§‰æ„ä¹‰ä¸å¤§ğŸ¤”ã€‚</p>
<h2 id="æ­£æ–‡">æ­£æ–‡</h2>
<p>PWA æœ‰å¾ˆå¤šè¦æ±‚ï¼Œæ¯”å¦‚ï¼šHTTPSã€å“åº”å¼å¸ƒå±€ç­‰ç­‰ï¼Œå¯å‚è€ƒè¿™ä¸ª <a href="https://developers.google.com/web/progressive-web-apps/checklist">Checklist</a>ï¼Œå¯ç”¨ <a href="https://developers.google.com/web/tools/lighthouse">Lighthouse</a><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> æ£€æŸ¥ã€‚</p>
<p><sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup><img src="https://base.oribos.city/images/2020/07/lighthouse-report.png" alt="lighthouse-report.png" title="æœ¬ç«™é¦–é¡µçš„ Lighthouse æµ‹è¯•æŠ¥å‘Š"></p>
<p>å…³äºå›¾æ ‡å’Œ <a href="https://developers.google.com/web/fundamentals/web-app-manifest/"><code>manifest.json</code></a>ï¼Œå¯ä»¥é€šè¿‡<a href="https://realfavicongenerator.net/">è¿™ä¸ªç½‘ç«™</a>åœ¨çº¿ç”Ÿæˆã€‚å¦‚æœä½ ä¸ç¡®å®šï¼Œå¯ä»¥å‚è€ƒ<a href="https://github.com/reuixiy/io-oi.me/tree/master/static">æˆ‘çš„åšå®¢</a>ä»¥åŠ MemE ä¸»é¢˜çš„<a href="https://github.com/reuixiy/hugo-theme-meme/blob/8de3b8d8c2ffe79df999079cdd2a21d536e44db2/layouts/partials/head.html#L79-L90">ç›¸å…³ä»£ç </a>ã€‚</p>
<hr>
<p>åœ¨ PWA çš„ä¼—å¤šè¦æ±‚ä¸­ï¼Œå…¶ä¸­å¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯å¯ç¦»çº¿è®¿é—®ï¼Œè€Œè¦å®ç°è¿™ä¸€ç‚¹ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ <a href="https://developers.google.com/web/fundamentals/primers/service-workers/">Service Worker</a>ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <a href="https://developers.google.com/web/tools/workbox/">Workbox</a> è¿™ä¸ªå·¥å…·ç”Ÿæˆ <code>sw.js</code> ä»¥å¿«é€Ÿå®ç° Service Worker ğŸ¤–ï¼Œå¹¶å®ç°é¡µé¢çš„é¢„ç¼“å­˜å’Œé¡µé¢æ›´æ–°åçš„æé†’åŠŸèƒ½ï¼Œè€Œéæ·±ç©¶ Service Worker çš„æ¥å£ç„¶åæ‰‹åŠ¨å†™ JS ä»£ç æ¥å®ç°ğŸ‘¨â€ğŸ’»ğŸ¶&hellip;</p>
<p>ç”±äºæˆ‘ä»¬éœ€è¦ä½¿ç”¨ Node çš„æ¨¡å—ï¼Œå› æ­¤æˆ‘ä»¬çš„ç”µè„‘å¿…é¡»å®‰è£… <a href="https://nodejs.org/zh-cn/download/">Node.js</a>ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Hexoï¼Œé‚£ä¹ˆæ˜¯å·²ç»å®‰è£…è¿‡çš„ï¼›å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Hugoï¼Œé‚£ä¹ˆè¯·è‡ªè¡Œå®‰è£…ä¸€ä¸‹ã€‚ç„¶åï¼Œæˆ‘ä»¬å®‰è£…æ¨¡å—ğŸ“¦ï¼š</p>
<pre tabindex="0"><code>~/blog $ npm install workbox-build gulp gulp-uglify readable-stream uglify-es --save-dev
</code></pre><blockquote>
<p>å¦‚ä½•å°†å®‰è£…çš„æ¨¡å—æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬å‘¢ï¼Ÿ</p>
<pre tabindex="0"><code>~/blog $ npm update
</code></pre><p>å¦‚æœä¸ç”Ÿæ•ˆï¼Œå¯ç»§ç»­å°è¯•ï¼ˆä¸‹æ–¹ä»¥ <code>workbox-build</code> ä¸ºä¾‹ï¼‰ï¼š</p>
<pre tabindex="0"><code>~/blog $ npm outdated
Package        Current  Wanted  Latest  Location
workbox-build    4.3.1   4.3.1   5.0.0  blog

~/blog $ npm install workbox-build@latest
</code></pre><p><a href="https://bytearcher.com/articles/using-npm-update-and-npm-outdated-to-update-dependencies/">https://bytearcher.com/articles/using-npm-update-and-npm-outdated-to-update-dependencies/</a></p>
</blockquote>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨åšå®¢æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª <code>gulpfile.js</code> æ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;gulp&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">workbox</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;workbox-build&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">uglifyes</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;uglify-es&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">composer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-uglify/composer&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">uglify</span> <span class="o">=</span> <span class="nx">composer</span><span class="p">(</span><span class="nx">uglifyes</span><span class="p">,</span> <span class="nx">console</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">pipeline</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;readable-stream&#39;</span><span class="p">).</span><span class="nx">pipeline</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;generate-service-worker&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">injectManifest</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">swSrc</span><span class="o">:</span> <span class="s1">&#39;./sw-template.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">swDest</span><span class="o">:</span> <span class="s1">&#39;./public/sw.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">globDirectory</span><span class="o">:</span> <span class="s1">&#39;./public&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">globPatterns</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;**/*.{html,css,js,json,woff2}&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nx">modifyURLPrefix</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;&#34;</span><span class="o">:</span> <span class="s2">&#34;./&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s2">&#34;uglify&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">pipeline</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s2">&#34;./public/sw.js&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">uglify</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s2">&#34;./public&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s2">&#34;build&#34;</span><span class="p">,</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">series</span><span class="p">(</span><span class="s2">&#34;generate-service-worker&#34;</span><span class="p">,</span> <span class="s2">&#34;uglify&#34;</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œ<code>globPatterns</code> å°±æ˜¯ç”Ÿæˆçš„é¢„ç¼“å­˜åˆ—è¡¨çš„æ–‡ä»¶åŒ¹é…æ¨¡å¼ï¼Œåœ¨è¿™é‡Œå°±æ˜¯å°†æ‰€æœ‰çš„ <code>html</code>ã€<code>css</code>ã€<code>js</code>ã€<code>json</code>ã€<code>woff2</code> æ–‡ä»¶é¢„ç¼“å­˜ï¼Œå³åšå®¢é¦–æ¬¡åŠ è½½æ—¶ï¼Œè‡ªåŠ¨å°†è¿™äº›æ–‡ä»¶ç¼“å­˜ã€‚</p>
<hr>
<p>ç„¶åï¼Œå†æ–°å»ºä¸€ä¸ª <code>sw-template.js</code> æ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">workboxVersion</span> <span class="o">=</span> <span class="s1">&#39;5.0.0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">importScripts</span><span class="p">(</span><span class="sb">`https://storage.googleapis.com/workbox-cdn/releases/</span><span class="si">${</span><span class="nx">workboxVersion</span><span class="si">}</span><span class="sb">/workbox-sw.js`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">setCacheNameDetails</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">prefix</span><span class="o">:</span> <span class="s2">&#34;reuixiy&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">skipWaiting</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">clientsClaim</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">precaching</span><span class="p">.</span><span class="nx">precacheAndRoute</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">__WB_MANIFEST</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">precaching</span><span class="p">.</span><span class="nx">cleanupOutdatedCaches</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sr">/\.(?:png|jpg|jpeg|gif|bmp|webp|svg|ico)$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">CacheFirst</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">cacheName</span><span class="o">:</span> <span class="s2">&#34;images&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">expiration</span><span class="p">.</span><span class="nx">ExpirationPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">maxEntries</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">maxAgeSeconds</span><span class="o">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl">            <span class="p">}),</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">cacheableResponse</span><span class="p">.</span><span class="nx">CacheableResponsePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">statuses</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Fonts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sr">/\.(?:eot|ttf|woff|woff2)$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">CacheFirst</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">cacheName</span><span class="o">:</span> <span class="s2">&#34;fonts&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">expiration</span><span class="p">.</span><span class="nx">ExpirationPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">maxEntries</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">maxAgeSeconds</span><span class="o">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl">            <span class="p">}),</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">cacheableResponse</span><span class="p">.</span><span class="nx">CacheableResponsePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">statuses</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Google Fonts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sr">/^https:\/\/fonts\.googleapis\.com/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">StaleWhileRevalidate</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">cacheName</span><span class="o">:</span> <span class="s2">&#34;google-fonts-stylesheets&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sr">/^https:\/\/fonts\.gstatic\.com/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">CacheFirst</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">cacheName</span><span class="o">:</span> <span class="s1">&#39;google-fonts-webfonts&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">expiration</span><span class="p">.</span><span class="nx">ExpirationPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">maxEntries</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">maxAgeSeconds</span><span class="o">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl">            <span class="p">}),</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">cacheableResponse</span><span class="p">.</span><span class="nx">CacheableResponsePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">statuses</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Static Libraries
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sr">/^https:\/\/cdn\.jsdelivr\.net/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">CacheFirst</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">cacheName</span><span class="o">:</span> <span class="s2">&#34;static-libs&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">expiration</span><span class="p">.</span><span class="nx">ExpirationPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">maxEntries</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">maxAgeSeconds</span><span class="o">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl">            <span class="p">}),</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">cacheableResponse</span><span class="p">.</span><span class="nx">CacheableResponsePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">statuses</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// External Images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sr">/^https:\/\/raw\.githubusercontent\.com\/reuixiy\/hugo-theme-meme\/master\/static\/icons\/.*/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">CacheFirst</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">cacheName</span><span class="o">:</span> <span class="s2">&#34;external-images&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">expiration</span><span class="p">.</span><span class="nx">ExpirationPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">maxEntries</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">maxAgeSeconds</span><span class="o">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl">            <span class="p">}),</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">cacheableResponse</span><span class="p">.</span><span class="nx">CacheableResponsePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">statuses</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">googleAnalytics</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œè¯·å°† <code>prefix</code> ä¿®æ”¹ä¸ºä½ åšå®¢çš„åå­—ï¼ˆè‹±æ–‡ï¼‰ï¼Œè¯·æŸ¥çœ‹ Workbox çš„ <a href="https://github.com/GoogleChrome/workbox/releases">Releases</a> é¡µé¢å¹¶åŠ¡å¿…è§†..ç‰ˆæœ¬è¯´æ˜..ä¿®æ”¹ <code>workboxVersion</code> ä¸ºæœ€æ–°ç‰ˆï¼Œå…¶å®ƒé¡¹ä¹Ÿè¯·åŠ¡å¿…ç»“åˆä½ çš„æƒ…å†µè‡ªè¡Œä¿®æ”¹ã€‚å¦‚æœä½ æƒ³ç”¨å…¶å®ƒç¼“å­˜ç­–ç•¥ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹<a href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies">ç›¸å…³æ–‡æ¡£</a>ã€‚åŒæ—¶ï¼Œæé†’ä¸€ä¸‹ï¼Œ..ç»å¯¹ä¸è¦..ç¼“å­˜è§†é¢‘æˆ–è€…é¢„ç¼“å­˜å›¾ç‰‡ã€‚</p>
<hr>
<p>æœ¬åœ°æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<pre tabindex="0"><code>~/blog $ ./node_modules/gulp/bin/gulp.js build
</code></pre><p>ä½ å¯ä»¥æ‰‹åŠ¨æ£€æŸ¥ä¸€ä¸‹ç”Ÿæˆçš„ <code>sw.js</code> æ–‡ä»¶ï¼ˆåœ¨ <code>public</code> æ–‡ä»¶å¤¹å†…ï¼‰ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æœ¬åœ° F12 è°ƒè¯•ä¸€ä¸‹ï¼ŒHugo çš„è¯ <code>hugo server -D --renderToDisk --environment production</code>ï¼ŒHexo çš„è¯ç›´æ¥ <code>hexo s</code>ã€‚</p>
<hr>
<p>ç”Ÿæˆ <code>sw.js</code> æ–‡ä»¶åï¼Œè¿˜æ²¡ç»“æŸå“¦ï¼Œæˆ‘ä»¬è¿˜è¦åœ¨ HTML é¡µé¢ä¸­åŠ å…¥ç›¸å…³ä»£ç ä»¥æ³¨å†Œ Service Workerï¼Œå¹¶æ·»åŠ é¡µé¢æ›´æ–°åçš„æé†’åŠŸèƒ½ã€‚åœ¨è¿™é‡Œå¯èƒ½è¦ç¼–è¾‘ä½ çš„ä¸»é¢˜ç›¸å…³æ¨¡æ¿æ–‡ä»¶ï¼ŒæŠŠä»¥ä¸‹ä»£ç æ”¾åœ¨ <code>&lt;/body&gt;</code> çš„å‰é¢ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;app-refresh&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app-refresh&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;app-refresh-wrap&#34;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&#34;location.reload()&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>å·²æ›´æ–°æœ€æ–°ç‰ˆæœ¬<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>ç‚¹å‡»åˆ·æ–°<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;serviceWorker&#39;</span> <span class="k">in</span> <span class="nx">navigator</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">controller</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;controllerchange&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">showNotification</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;/sw.js&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">showNotification</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;meta[name=theme-color]&#39;</span><span class="p">).</span><span class="nx">content</span> <span class="o">=</span> <span class="s1">&#39;#000&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;app-refresh&#39;</span><span class="p">).</span><span class="nx">className</span> <span class="o">+=</span> <span class="s1">&#39; app-refresh-show&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†æ·»åŠ ä»¥ä¸‹ CSS æ ·å¼åˆ°ä½ çš„ <code>custom.styl</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="p">.</span><span class="nc">app-refresh</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">background</span><span class="p">:</span> <span class="mh">#000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">height</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">line-height</span><span class="p">:</span> <span class="mi">3</span><span class="kt">em</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">overflow</span><span class="p">:</span> <span class="kc">hidden</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">right</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">z-index</span><span class="p">:</span> <span class="mi">42</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">1</span><span class="kt">em</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">transition</span><span class="p">:</span> <span class="kc">all</span> <span class="mf">.3</span><span class="kt">s</span> <span class="kc">ease</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">app-refresh-wrap</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">color</span><span class="p">:</span> <span class="mh">#fff</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">app-refresh-wrap</span> <span class="nt">label</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">flex</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">app-refresh-show</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">height</span><span class="p">:</span> <span class="mi">3</span><span class="kt">em</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ å¯ä»¥ä¿®æ”¹ä¸€ä¸‹ä½ çš„æŸç¯‡æ–‡ç« ï¼Œç„¶åå†æ¬¡ç”Ÿæˆ <code>sw.js</code>ï¼Œæœ€åæµè§ˆå™¨åˆ·æ–°ä¸€ä¸‹æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<hr>
<p>è¿™ç§æ–¹æ³•æ˜¯é€‚åˆå„ç§é™æ€åšå®¢çš„ğŸ˜ï¼Œä¸ç®¡ä½ çš„ SSG<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup> æ˜¯ <a href="https://gohugo.io/">Hugo</a>ï¼Œæˆ–æ˜¯ <a href="https://hexo.io/">Hexo</a>ï¼Œè¿˜æ˜¯å…¶å®ƒã€‚å¦å¤–ï¼ŒHugo çš„ <a href="https://github.com/reuixiy/hugo-theme-meme">MemE</a> ä¸»é¢˜æ˜¯æ”¯æŒ Service Worker è¿™ä¸ªåŠŸèƒ½çš„ï¼Œå› ä¸ºä»¥ä¸Šå†…å®¹å…¶å®å°±æ˜¯æˆ‘åœ¨å¼€å‘è¯¥ä¸»é¢˜æ—¶æ‘¸ç´¢å‡ºæ¥ğŸ¶ã€‚æœ€åï¼Œå¦‚æœä½ å¯¹è‡ªåŠ¨åŒ–çš„æŒç»­é›†æˆéƒ¨ç½²æœ‰ç–‘æƒ‘ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„<a href="https://github.com/reuixiy/io-oi.me">åšå®¢æºç </a>ä»¥åŠæˆ‘ä¹‹å‰å†™çš„<a href="/tech/host-your-blog-on-ipfs/">ä¸€ç¯‡æ–‡ç« </a>ã€‚</p>
<h2 id="references--resources">References &amp; Resources</h2>
<p>Workboxï¼š</p>
<ol>
<li><a href="https://www.thepolyglotdeveloper.com/2019/03/service-workers-workbox-hugo-static-generated-site/">Service Workers With Workbox In A Hugo Static Generated Site | The Polyglot Developer</a></li>
<li><a href="https://karannagupta.com/using-custom-workbox-service-workers-with-create-react-app/">Using Custom Workbox Service Workers with Create-React-App (without ejecting) | Karan NA Gupta</a></li>
<li><a href="https://blog.skk.moe/post/hello-workbox/">Workbox, not sw-toolbox &amp; sw-precache | Sukkaâ€™s Blog</a></li>
<li><a href="https://developers.google.com/web/tools/workbox/guides/precache-files/workbox-build">Precache Files with workbox-build | Workbox | Google Developers</a></li>
<li><a href="https://developers.google.com/web/tools/workbox/guides/common-recipes">Common Recipes | Workbox |Â Google Developers</a></li>
<li><a href="https://developers.google.com/web/tools/workbox/modules/workbox-window">Workbox Window | WorkboxÂ |Â Google Developers</a></li>
<li><a href="https://zoumiaojiang.com/article/amazing-workbox-3/">ç¥å¥‡çš„ Workbox 3.0 | zoumiaojiang</a></li>
<li><a href="https://developers.google.com/web/tools/workbox/guides/migrations/migrate-from-v4">Migrate from Workbox v4 to v5 | Google Developers</a></li>
<li><a href="https://developers.google.com/web/tools/workbox/reference-docs/latest/workbox">Namespace: workbox | Google Developers</a></li>
</ol>
<p>Notificationï¼š</p>
<ol>
<li><a href="https://github.com/craigjennings11/bible-app/blob/master/src/service-worker/sw-installer.js">bible-app/sw-installer.js | craigjennings11/bible-app | GitHub</a></li>
<li><a href="https://github.com/arnellebalane/arnellebalane.com/blob/master/source/static/javascripts/main.mjs">arnellebalane.com/main.mjs | arnellebalane/arnellebalane.com | GitHub</a></li>
<li><a href="https://github.com/zoumiaojiang/hexo-service-worker/blob/master/src/templates/sw-register.tpl.js">hexo-service-worker/sw-register.tpl.js | zoumiaojiang/hexo-service-worker | GitHub</a></li>
<li><a href="https://github.com/fredliang44/hugo-theme-refine/blob/master/layouts/partials/service-worker.html">hugo-theme-refine/service-worker.html | fredliang44/hugo-theme-refine | GitHub</a></li>
<li><a href="https://medium.com/@webmaxru/workbox-4-implementing-refresh-to-update-version-flow-using-the-workbox-window-module-41284967e79c">Workbox 4: Implementing refresh-to-update-version flow using the workbox-window module | Medium</a></li>
<li><a href="https://samvloeberghs.be/posts/lessons-learned-on-offline-capabilities-with-service-workers-using-workbox-the-sequel">Lessons learned on offline capabilities with service workers using Workbox | Sam Vloeberghs</a></li>
<li><a href="https://github.com/reuixiy/hugo-theme-meme/blob/master/layouts/partials/third-party/service-worker.html">hugo-theme-meme/service-worker.html | reuixiy/hugo-theme-meme | GitHub</a></li>
<li><a href="https://github.com/jeffposnick/jeffposnick.github.io/blob/active/_posts/_includes/register_service_worker.njk">jeffposnick.github.io/_posts/_includes/register_service_worker.njk | GitHub</a></li>
</ol>
<p>PWAï¼š</p>
<ol>
<li><a href="https://harttle.land/2017/04/09/service-worker-now.html">ç«‹å³ä½¿ç”¨ Service Workerï¼ | Harttle Land</a></li>
<li><a href="https://harttle.land/2019/03/27/from-spa-to-pwa.html">ä» SPA åˆ° PWA | Harttle Land</a></li>
<li><a href="https://blog.fredliang.cn/posts/2019-05-16-mini-program-vs-pwa/">å°ç¨‹åºæ ‡å‡†åŒ– &amp; PWA | Fredâ€™s Blog</a></li>
</ol>
<hr>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>æ¥æºï¼š<a href="https://developers.google.com/web/tools/workboxhttps://base.oribos.city/images/2020/07/pwa.svg">https://developers.google.com/web/tools/workboxhttps://base.oribos.city/images/2020/07/pwa.svg</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>å‚è€ƒâ‘ ï¼š<a href="https://zh.wikipedia.org/wiki/%E6%B8%90%E8%BF%9B%E5%BC%8F%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F">https://zh.wikipedia.org/wiki/æ¸è¿›å¼ç½‘ç»œåº”ç”¨ç¨‹åº</a><br>
å‚è€ƒâ‘¡ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/Progressive_web_apps">https://developer.mozilla.org/zh-CN/docs/Web/Progressive_web_apps</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>å®‰åˆ©ä¸€ä¸ªæä¾›åœ¨çº¿æµ‹è¯•çš„ç½‘ç«™ï¼š<a href="https://www.webpagetest.org/lighthouse">https://www.webpagetest.org/lighthouse</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p><a href="https://www.webpagetest.org/result/191003_X2_834c7f82e1a525b190986e3ec91e2927/">https://www.webpagetest.org/result/191003_X2_834c7f82e1a525b190986e3ec91e2927/</a>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œ<a href="https://www.staticgen.com/">Static Site Generator</a>ï¼Œç®€ç§° SSGã€‚&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

	</article>
</main>





	

	

	


  
  


<footer class="mt-8 flex sm:flex-col-reverse justify-between items-center">
  <p class="mt-0 text-sm-3">
    Â©nierheim |
    <a href="https://gohugo.io" target="_blank" rel="noopener noreferrer">Hugo</a> on
    <a href="https://github.com/mivinci/hugo-theme-minima" target="_blank" rel="noopener noreferrer">Minima</a>
    |<a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer">è±«ICPå¤‡2020027870å·-2</a>
  </p>
  <p class="flex items-center mt-0">
    
      <a class="icon mx-2" href="https://github.com/oribos/pub" title="github">
      
        <svg fill="#63636f" width="18" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
      
      </a>
    
      <a class="icon mx-2" href="/index.xml" title="rss">
      
        <svg fill="#63636f" t="1626591563876" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1984" width="18" height="16"><path d="M128 768a128 128 0 1 0 0 256 128 128 0 0 0 0-256zM0 368v176c265.104 0 480 214.912 480 480h176c0-362.32-293.696-656-656-656zM0 0v176c468.336 0 848 379.664 848 848h176C1024 458.464 565.536 0 0 0z" p-id="1985"></path></svg>
      
      </a>
    
  </p>
</footer>
  <style>

    #upBtn {
      display: none;  
    }
    
    .shareBtn {
    margin: 2 auto;
    position: fixed; 
    z-index: 99; 
    cursor: pointer; 
    bottom: 70px; 
    right: 16px; 
    width: 52px;
    float: left;
    text-align: center;
    }
    
</style>
    
    <div class="container-fluid">
        <div class="shareBtn">
                <a  id="upBtn"  href="javascript:topFunction()" title="å‘ä¸Š"> <i class="fa fa-arrow-up fa-2x text-info"></i></a>
        </div>
    </div>
</body>
</html>